<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from pocketbase.io/docs/go-migrations by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 26 Jun 2024 08:32:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <meta name="description" content="Open Source backend in 1 file with realtime database, authentication, file storage and admin dashboard">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="PocketBase - Open Source backend in 1 file">
    <meta property="og:description" content="Open Source backend in 1 file with realtime database, authentication, file storage and admin dashboard">
    <meta property="og:image" content="../images/og.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="PocketBase - Open Source backend in 1 file">
    <meta property="twitter:description" content="Open Source backend in 1 file with realtime database, authentication, file storage and admin dashboard">
    <meta property="twitter:image" content="../images/og.png">

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://pocketbase.io/images/favicon/site.webmanifest">
    <link rel="mask-icon" href="https://pocketbase.io/images/favicon/safari-pinned-tab.svg" color="#000000">
    <link rel="shortcut icon" href="https://pocketbase.io/images/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="https://pocketbase.io/images/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- preload -->
    <link rel="preload" href="https://pocketbase.io/fonts/source-sans-pro/source-sans-pro-v18-latin_cyrillic-regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://pocketbase.io/fonts/source-sans-pro/source-sans-pro-v18-latin_cyrillic-600.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://pocketbase.io/fonts/source-sans-pro/source-sans-pro-v18-latin_cyrillic-700.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://pocketbase.io/fonts/source-sans-pro/source-sans-pro-v18-latin_cyrillic-italic.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://pocketbase.io/fonts/ubuntu-mono/ubuntu-mono-v17-cyrillic_latin-regular.woff2" as="font" type="font/woff2" crossorigin>

    <script>
        // CSS3 animations support check
        (function () {
            if (typeof document === "undefined") {
                return; // serverside rendering
            }

            let elem = document.createElement("div");
            let hasAnimation = elem.style.animationName !== undefined;

            if (!hasAnimation) {
                document.documentElement.classList.add("no-animations");
            }
        })();
    </script>

    <script>
        // silent svelte console errors
        if (typeof window === "undefined") {
            window = {};
        }
        window.Prism = window.Prism || {};
        window.Prism.manual = true;

        if (typeof navigator !== "undefined" && navigator.userAgentData) {
            navigator.userAgentData.getHighEntropyValues([
                "architecture",
            ]).then((ua) => {
                window.UA_ARCHITECTURE = ua.architecture
            });
        }
    </script>

    
		<link href="../_app/immutable/assets/2.0975cac3.css" rel="stylesheet">
		<link href="../_app/immutable/assets/main.a2ec6d35.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.9c47a874.css" rel="stylesheet">
		<link href="../_app/immutable/assets/CodeBlock.d22afb3e.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.c884ba35.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.a7566c1a.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/singletons.01dc88c8.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.f5b995db.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.7b6d4e54.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.1674d90f.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.d9b2382e.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/PageFooter.186a253e.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/tooltip.f1d7ab7e.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CommonHelper.7329e1a7.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.a42e91c2.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/stores.fb1f6c95.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preferences.0fc33f39.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/27.bea5375d.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/HeadingLink.20322812.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CodeBlock.a090ee9b.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Toc.c31a36b6.js"><title>Extend with Go - Migrations - Docs - PocketBase</title><!-- HEAD_svelte-q27gla_START --><!-- HEAD_svelte-q27gla_END -->
</head>
<body>
    <div class="page-body">



<header class="page-header"><div class="wrapper wrapper-lg"><a href="https://pocketbase.io/" class="logo logo-sm"><img src="https://pocketbase.io/images/logo.svg" alt="PocketBase logo" width="40" height="40">
            <span class="txt">Pocket<strong>Base</strong></span>
            <span class="version">v0.22.14</span></a>

        <div class="flex-fill"></div>

        
        

        

        <button type="button" class="btn btn-circle btn-secondary responsive-menu-btn" title="Menu"><span></span>
            <i class="ri-menu-3-fill"></i>
            

<div class="toggler-container"></div></button>

        <nav class="main-menu"><a href="https://pocketbase.io/faq" class="btn btn-secondary">FAQ</a>
            <a href="https://github.com/pocketbase/pocketbase/discussions" class="btn btn-secondary" target="_blank" rel="noreferrer noopener">Discussions
            </a>
            <a href="https://github.com/pocketbase/pocketbase" class="btn btn-circle btn-secondary" target="_blank" rel="noreferrer noopener" title="GitHub Repo"><i class="ri-github-line"></i></a>
            <a href="https://pocketbase.io/docs" class="btn btn-outline btn-expanded"><span class="txt">Documentation</span></a></nav></div></header>

<main class="wrapper wrapper-lg page-content-wrapper">

<aside class="page-sidebar highlight docs-sidebar"><div class="sticky-wrapper svelte-1izh69t"><div class="absolute-wrapper svelte-1izh69t"><div class="sidebar-content svelte-1izh69t"><nav class="sidebar-list">
        
        <a href="https://pocketbase.io/docs" class="list-item">
            <span class="icon"><i class="ri-home-2-line"></i></span>
            <span class="txt">Introduction</span>
            </a>
        
        
        <a href="collections.html" class="list-item">
            <span class="icon"><i class="ri-database-2-line"></i></span>
            <span class="txt">Collections</span>
            </a>
        
        
        <a href="api-rules-and-filters.html" class="list-item">
            <span class="icon"><i class="ri-shield-check-line"></i></span>
            <span class="txt">API rules and filters</span>
            </a>
        
        
        <a href="client-side-sdks.html" class="list-item">
            <span class="icon"><i class="ri-tools-line"></i></span>
            <span class="txt">Client-side SDKs</span>
            </a>
        
        
        <a href="authentication.html" class="list-item">
            <span class="icon"><i class="ri-group-line"></i></span>
            <span class="txt">Authentication</span>
            </a>
        
        
        <a href="files-handling.html" class="list-item">
            <span class="icon"><i class="ri-upload-cloud-line"></i></span>
            <span class="txt">Files upload and handling</span>
            </a>
        
        
        <a href="working-with-relations.html" class="list-item">
            <span class="icon"><i class="ri-mind-map"></i></span>
            <span class="txt">Working with relations</span>
            </a>
        
        
        <a href="use-as-framework.html" class="list-item">
            <span class="icon"><i class="ri-code-s-slash-line"></i></span>
            <span class="txt">Use as framework</span>
            </a>
        
        
        <a href="api-records.html" class="list-item">
            <span class="icon"><i class="ri-file-list-2-line"></i></span>
            <span class="txt">Web APIs reference</span>
            </a>
        
        
        <a href="going-to-production.html" class="list-item">
            <span class="icon"><i class="ri-check-double-line"></i></span>
            <span class="txt">Going to production</span>
            </a>
        </nav>

                <div class="clearfix m-t-base"></div>

                <div class="sidebar-bg-section"><div class="tabs-header stretched compact"><a class="tab-item active" href="go-overview.html"><div class="block">Extend with
                                <br>
                                <strong>Go</strong></div></a>
                        <a class="tab-item" href="js-overview.html"><div class="block">Extend with
                                <br>
                                <strong>JavaScript</strong></div></a></div>
                    <div class="tabs-content"><div class="tab-item active"><nav class="sidebar-list">
        
        <a href="go-overview.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Overview</span>
            </a>
        
        
        <a href="go-event-hooks.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Event hooks</span>
            </a>
        
        
        <a href="go-routing.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Routing</span>
            </a>
        
        
        <a href="go-database.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Database</span>
            </a>
        
        
        <a href="go-records.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Record operations</span>
            </a>
        
        
        <a href="go-collections.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Collection operations</span>
            </a>
        
        
        <a href="go-migrations.html" class="list-item active"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Migrations</span>
            </a>
        
        
        <a href="go-jobs-scheduling.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Jobs scheduling</span>
            </a>
        
        
        <a href="go-console-commands.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Console commands</span>
            </a>
        
        
        <a href="go-sending-emails.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Sending emails</span>
            </a>
        
        
        <a href="go-rendering-templates.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Rendering templates</span>
            </a>
        
        
        <a href="go-logging.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Logging</span>
            </a>
        
        
        <a href="go-testing.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Testing</span>
            </a>
        
        
        <a href="go-custom-models.html" class="list-item"><span class="label label-sm label-info svelte-1izh69t">Go</span>
            
            <span class="txt">Custom models</span>
            </a>
        </nav></div>
                        <div class="tab-item"><nav class="sidebar-list">
        
        <a href="js-overview.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Overview</span>
            </a>
        
        
        <a href="js-event-hooks.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Event hooks</span>
            </a>
        
        
        <a href="js-routing.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Routing</span>
            </a>
        
        
        <a href="js-database.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Database</span>
            </a>
        
        
        <a href="js-records.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Record operations</span>
            </a>
        
        
        <a href="js-collections.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Collection operations</span>
            </a>
        
        
        <a href="js-migrations.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Migrations</span>
            </a>
        
        
        <a href="js-jobs-scheduling.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Jobs scheduling</span>
            </a>
        
        
        <a href="js-console-commands.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Console commands</span>
            </a>
        
        
        <a href="js-sending-emails.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Sending emails</span>
            </a>
        
        
        <a href="js-sending-http-requests.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Sending HTTP requests</span>
            </a>
        
        
        <a href="js-rendering-templates.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Rendering templates</span>
            </a>
        
        
        <a href="js-logging.html" class="list-item"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Logging</span>
            </a>
        
        
        <a href="https://pocketbase.io/jsvm/index.html" class="list-item" target="_blank" rel="noopener noreferrer"><span class="label label-sm label-warning svelte-1izh69t">JS</span>
            
            <span class="txt">Types reference</span>
            </a>
        </nav></div></div></div></div></div></div>
</aside>

<div class="page-content"><nav class="breadcrumbs"><div class="breadcrumb-item">Extend with Go - Migrations</div></nav>

    <div class="content"><p>PocketBase comes with a builtin DB and data migration utility, allowing you to version your DB structure,
    create collections programmatically, initialize default settings, etc.
</p>
<p>Because the migrations are regular Go functions, besides applying schema changes, they could be used also
    to adjust existing data to fit the new schema or any other app specific logic that you want to run only
    once.
</p>
<p>And as a bonus, being <code>.go</code> files also ensures that the migrations will be embedded seamlessly in
    your final executable.
</p>

<div class="toc"><ul class="toc-list-1"></ul></div>

<h3 id="enable-the-migrate-command" class="heading-link "><a href="#enable-the-migrate-command" class="link-primary">
        Enable the migrate command
        </a></h3>
<p>The prebuilt executable enables the <code>migrate</code> command by default, but when you are extending PocketBase
    with Go you have to enable it manually:
</p>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// main.go</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"log"</span>
    <span class="token string">"strings"</span>

    <span class="token string">"github.com/pocketbase/pocketbase"</span>
    <span class="token string">"github.com/pocketbase/pocketbase/plugins/migratecmd"</span>

    <span class="token comment">// uncomment once you have at least one .go migration file in the "migrations" directory</span>
    <span class="token comment">// _ "yourpackage/migrations"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app <span class="token operator">:=</span> pocketbase<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// loosely check if it was executed using "go run"</span>
    isGoRun <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">TempDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    migratecmd<span class="token punctuation">.</span><span class="token function">MustRegister</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> app<span class="token punctuation">.</span>RootCmd<span class="token punctuation">,</span> migratecmd<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
        <span class="token comment">// enable auto creation of migration files when making collection changes in the Admin UI</span>
        <span class="token comment">// (the isGoRun check is to enable it only during development)</span>
        Automigrate<span class="token punctuation">:</span> isGoRun<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> app<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><!-- HTML_TAG_END --></code>
</div>
<p>The above example also shows the <code>Automigrate</code> config option which when enabled will create automatically
    a Go migration file for you for every collection change made in the Admin UI.
</p>

<h3 id="creating-migrations" class="heading-link "><a href="#creating-migrations" class="link-primary">
        Creating migrations
        </a></h3>
<p>To create a new blank migration you can run <code>migrate create</code>.
</p>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// Since the "create" command makes sense only during development,</span>
<span class="token comment">// it is expected the user to be in the app working directory</span>
<span class="token comment">// and to be using "go run ..."</span>

<span class="token punctuation">[</span>root@dev app<span class="token punctuation">]</span>$ go run main<span class="token punctuation">.</span>go migrate create <span class="token string">"your_new_migration"</span><!-- HTML_TAG_END --></code>
</div>
<div class="clearfix m-t-xs"></div>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// migrations/1655834400_your_new_migration.go</span>
<span class="token keyword">package</span> migrations

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/pocketbase/dbx"</span>
    m <span class="token string">"github.com/pocketbase/pocketbase/migrations"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
        <span class="token comment">// add up queries...</span>

        <span class="token keyword">return</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
        <span class="token comment">// add down queries...</span>

        <span class="token keyword">return</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><!-- HTML_TAG_END --></code>
</div>
<p>The above will create a new blank migration file inside the configured command <code>migrations</code> directory.
</p>
<p class="txt-bold">To make your application aware of the registered migrations, you simply have to import the above
    <code>migrations</code> package in one of your <code>main</code> package files:
</p>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token boolean">_</span> <span class="token string">"yourpackage/migrations"</span>

<span class="token comment">// ...</span><!-- HTML_TAG_END --></code>
</div>
<p class="txt-bold">New migrations are applied automatically on <code>serve</code>.</p>
<p>Optionally, you could apply new migrations manually by running <code>migrate up</code>.
</p>
<p>To revert the last applied migration(s), you could run <code>migrate down [number]</code>.
</p>

<h5 id="migration-file" class="heading-link "><a href="#migration-file" class="link-primary">
        Migration file
        </a></h5>
<p>Each migration file should have a single <code>m.Register(upFunc, downFunc)</code> call.</p>
<p>In the migration file, you are expected to write your &quot;upgrade&quot; code in the <code>upFunc</code> callback.
    <br>
    The <code>downFunc</code> is optional and it should contains the &quot;downgrade&quot; operations to revert the
    changes made by the <code>upFunc</code>.
</p>
<p>Both callbacks accept a single <code>db</code> argument (<code>dbx.Builder</code>) that you can use
    directly or create a <code>Dao</code> instance and use its available helpers. You can explore the
    <a href="go-database.html">Database guide</a>
    for more details how to operate with the <code>db</code> object and its available methods.
</p>

<h3 id="collections-snapshot" class="heading-link "><a href="#collections-snapshot" class="link-primary">
        Collections snapshot
        </a></h3>
<p>PocketBase comes also with a <code>migrate collections</code> command that will generate a full snapshot of
    your current Collections configuration without having to type it manually:
</p>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// Since the "collections" command makes sense only during development,</span>
<span class="token comment">// it is expected the user to be in the app working directory</span>
<span class="token comment">// and to be using "go run ..."</span>

<span class="token punctuation">[</span>root@dev app<span class="token punctuation">]</span>$ go run main<span class="token punctuation">.</span>go migrate collections<!-- HTML_TAG_END --></code>
</div>
<p>Similar to the <code>migrate create</code> command, this will generate a new migration file in the
    <code>migrations</code> directory.
</p>
<p>It is safe to run the command multiple times and generate multiple snapshot migration files.</p>

<h3 id="migrations-history" class="heading-link "><a href="#migrations-history" class="link-primary">
        Migrations history
        </a></h3>
<p>All applied migration filenames are stored in the internal <code>_migrations</code> table.
    <br>
    During local development often you might end up making various collection changes to test different approaches.
    <br>
    When <code>Automigrate</code> is enabled this could lead in a migration history with unnecessary intermediate
    steps that may not be wanted in the final migration history.
</p>
<p class="txt-bold">To avoid the clutter and to prevent applying the intermediate steps in production, you can remove (or
    squash) the unnecessary migration files manually and then update the local migrations history by running:
</p>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token punctuation">[</span>root@dev app<span class="token punctuation">]</span>$ go run main<span class="token punctuation">.</span>go migrate history<span class="token operator">-</span>sync<!-- HTML_TAG_END --></code>
</div>
<p>The above command will remove any entry from the <code>_migrations</code> table that doesn&#39;t have a related
    migration file associated with it.
</p>

<h3 id="examples" class="heading-link "><a href="#examples" class="link-primary">
        Examples
        </a></h3>

<h5 id="running-raw-sql-statements" class="heading-link "><a href="#running-raw-sql-statements" class="link-primary">
        Running raw SQL statements
        </a></h5>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// migrations/1687801090_set_pending_status.go</span>
<span class="token keyword">package</span> migrations

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/pocketbase/dbx"</span>
    m <span class="token string">"github.com/pocketbase/pocketbase/migrations"</span>
<span class="token punctuation">)</span>

<span class="token comment">// set a default "pending" status to all empty status articles</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
        <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">NewQuery</span><span class="token punctuation">(</span><span class="token string">"UPDATE articles SET status = 'pending' WHERE status = ''"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> err
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><!-- HTML_TAG_END --></code>
</div>

<h5 id="initialize-default-application-settings" class="heading-link "><a href="#initialize-default-application-settings" class="link-primary">
        Initialize default application settings
        </a></h5>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// migrations/1687801090_initial_settings.go</span>
<span class="token keyword">package</span> migrations

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/pocketbase/dbx"</span>
    <span class="token string">"github.com/pocketbase/pocketbase/daos"</span>
    m <span class="token string">"github.com/pocketbase/pocketbase/migrations"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
        dao <span class="token operator">:=</span> daos<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>

        settings<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> dao<span class="token punctuation">.</span><span class="token function">FindSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        settings<span class="token punctuation">.</span>Meta<span class="token punctuation">.</span>AppName <span class="token operator">=</span> <span class="token string">"test"</span>
        settings<span class="token punctuation">.</span>Logs<span class="token punctuation">.</span>MaxDays <span class="token operator">=</span> <span class="token number">2</span>

        <span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">SaveSettings</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><!-- HTML_TAG_END --></code>
</div>

<h5 id="creating-new-admin" class="heading-link "><a href="#creating-new-admin" class="link-primary">
        Creating new admin
        </a></h5>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// migrations/1687801090_initial_admin.go</span>
<span class="token keyword">package</span> migrations

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/pocketbase/dbx"</span>
    <span class="token string">"github.com/pocketbase/pocketbase/daos"</span>
    m <span class="token string">"github.com/pocketbase/pocketbase/migrations"</span>
    <span class="token string">"github.com/pocketbase/pocketbase/models"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
        dao <span class="token operator">:=</span> daos<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>

        admin <span class="token operator">:=</span> <span class="token operator">&amp;</span>models<span class="token punctuation">.</span>Admin<span class="token punctuation">{</span><span class="token punctuation">}</span>
        admin<span class="token punctuation">.</span>Email <span class="token operator">=</span> <span class="token string">"test@example.com"</span>
        admin<span class="token punctuation">.</span><span class="token function">SetPassword</span><span class="token punctuation">(</span><span class="token string">"1234567890"</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">SaveAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span> <span class="token comment">// optional revert operation</span>

        dao <span class="token operator">:=</span> daos<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>

        admin<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> dao<span class="token punctuation">.</span><span class="token function">FindAdminByEmail</span><span class="token punctuation">(</span><span class="token string">"test@example.com"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> admin <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">DeleteAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// already deleted</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><!-- HTML_TAG_END --></code>
</div>

<h5 id="creating-new-auth-record" class="heading-link "><a href="#creating-new-auth-record" class="link-primary">
        Creating new auth record
        </a></h5>
<div class="code-wrapper prism-light svelte-1qrji6i"><code class="svelte-1qrji6i"><!-- HTML_TAG_START --><span class="token comment">// migrations/1687801090_new_users_record.go</span>
<span class="token keyword">package</span> migrations

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/pocketbase/dbx"</span>
    <span class="token string">"github.com/pocketbase/pocketbase/daos"</span>
    m <span class="token string">"github.com/pocketbase/pocketbase/migrations"</span>
    <span class="token string">"github.com/pocketbase/pocketbase/models"</span>
    <span class="token string">"github.com/pocketbase/pocketbase/tools/security"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
        dao <span class="token operator">:=</span> daos<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>

        collection<span class="token punctuation">,</span> err <span class="token operator">:=</span> dao<span class="token punctuation">.</span><span class="token function">FindCollectionByNameOrId</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> err
        <span class="token punctuation">}</span>

        record <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">NewRecord</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span>
        record<span class="token punctuation">.</span><span class="token function">SetUsername</span><span class="token punctuation">(</span><span class="token string">"u_"</span> <span class="token operator">+</span> security<span class="token punctuation">.</span><span class="token function">RandomStringWithAlphabet</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"123456789"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        record<span class="token punctuation">.</span><span class="token function">SetPassword</span><span class="token punctuation">(</span><span class="token string">"1234567890"</span><span class="token punctuation">)</span>
        record<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"John Doe"</span><span class="token punctuation">)</span>
        record<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"test@example.com"</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">SaveRecord</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db dbx<span class="token punctuation">.</span>Builder<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span> <span class="token comment">// optional revert operation</span>
        dao <span class="token operator">:=</span> daos<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>

        record <span class="token operator">:=</span> dao<span class="token punctuation">.</span><span class="token function">FindFirstAuthRecordByEmail</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"test@example.com"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> record <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">DeleteRecord</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// already deleted</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><!-- HTML_TAG_END --></code>
</div></div>

    <hr>

    <div class="docs-footer svelte-1dbn67j"><a href="go-collections.html" class="btn btn-secondary btn-prev svelte-1dbn67j"><i class="ri-arrow-left-line"></i>
            <span class="txt">Prev: Collection operations</span></a>

    <a href="go-jobs-scheduling.html" class="btn btn-outline btn-expanded btn-next svelte-1dbn67j"><span class="txt">Next: Jobs scheduling</span>
            <i class="ri-arrow-right-line"></i></a>
</div></div></main>

<footer class="page-footer"><div class="wrapper wrapper-lg"><div class="primary-bar"><nav class="footer-col links"><a href="https://pocketbase.io/faq" class="link-item">FAQ</a>
                <a href="https://github.com/pocketbase/pocketbase/discussions" class="link-item" target="_blank" rel="noopener noreferrer">Discussions
                </a>
                <a href="https://pocketbase.io/docs" class="link-item">Documentation</a></nav>

            <nav class="footer-col links"><a href="https://github.com/pocketbase/js-sdk" class="link-item" target="_blank" rel="noopener noreferrer">JavaScript SDK
                </a>
                <a href="https://github.com/pocketbase/dart-sdk" class="link-item" target="_blank" rel="noopener noreferrer">Dart SDK
                </a></nav>

            <div class="footer-col socials"><div class="watermark-logo">Pocket<strong>Base</strong></div>
                <a href="mailto:support" class="btn btn-secondary btn-circle btn-hint social-item" aria-label="Contact support"><i class="ri-mail-line"></i></a>
                <a href="https://twitter.com/pocketbase" rel="noopener noreferrer" target="_blank" class="btn btn-secondary btn-circle btn-hint social-item" aria-label="Go to Twitter"><i class="ri-twitter-line"></i></a>
                <a href="https://github.com/pocketbase/pocketbase" rel="noopener noreferrer" target="_blank" class="btn btn-secondary btn-circle btn-hint social-item" aria-label="Go to GitHub"><i class="ri-github-line"></i></a></div></div>
        <div class="secondary-bar"><div class="terms"><span class="txt">© 2023-2024 Pocket<strong>Base</strong></span>
                <span class="gopher-credit">The Gopher artwork is from
                    <a href="https://github.com/marcusolsson/gophers" target="_blank" rel="noreferrer noopener">marcusolsson/gophers
                    </a></span></div>
            <div class="flex-fill"></div>
            <div class="credit">Crafted by <a href="https://gani.bg/" target="_blank" rel="noopener noreferrer" class="link-hint"><strong>Gani</strong></a></div></div></div></footer>



<button type="button" class="btn btn-circle btn-secondary scroll-to-top svelte-h1x6u4" arial-label="Go to top"><i class="ri-arrow-up-line"></i>
</button>


			
			<script>
				{
					__sveltekit_1pqcct0 = {
						base: new URL("../..", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [null,null,null,null];

					Promise.all([
						import("../_app/immutable/entry/start.c884ba35.js"),
						import("../_app/immutable/entry/app.7b6d4e54.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 3, 27],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
</body>

<!-- Mirrored from pocketbase.io/docs/go-migrations by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 26 Jun 2024 08:32:30 GMT -->
</html>
